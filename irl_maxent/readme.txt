taken and improved from irl_maxent_w3 from GPU farm.